<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>ğŸŒ¸ Flower Garden</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@300;400;600&family=Cormorant+Garamond:ital,wght@0,300;1,300;1,400&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{
  width:100%;height:100%;overflow:hidden;
  background:#000;
  touch-action:none;
  -webkit-tap-highlight-color:transparent;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WELCOME SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#welcome{
  position:fixed;inset:0;
  z-index:100;
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  background:#000;
  transition:opacity .9s ease, visibility .9s;
}
#welcome.out{opacity:0;visibility:hidden;pointer-events:none;}

/* animated background on welcome */
#welcome-canvas{
  position:absolute;inset:0;
  width:100%;height:100%;
  opacity:.55;
}

.welcome-inner{
  position:relative;z-index:2;
  display:flex;flex-direction:column;
  align-items:center;
  gap:clamp(14px,3.5vh,32px);
  padding:clamp(16px,4vw,40px) clamp(14px,4vw,36px);
  width:min(540px,96vw);
  /* make sure content fits on small screens */
  max-height:100vh;
  overflow-y:auto;
  -webkit-overflow-scrolling:touch;
}

.w-title{
  font-family:'Cinzel',serif;
  font-size:clamp(20px,6.5vw,42px);
  font-weight:300;
  letter-spacing:.25em;
  color:#fff;
  text-align:center;
  text-shadow:0 0 30px rgba(255,120,200,.9), 0 0 80px rgba(255,80,180,.4);
  animation:titleFloat 3s ease-in-out infinite;
  line-height:1.2;
}
@keyframes titleFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-4px)}}

.w-sub{
  font-family:'Cormorant Garamond',serif;
  font-style:italic;
  font-size:clamp(12px,3.8vw,18px);
  color:rgba(255,200,230,.55);
  letter-spacing:.15em;
  text-align:center;
  line-height:1.5;
}

.w-label{
  font-family:'Cormorant Garamond',serif;
  font-style:italic;
  font-size:clamp(10px,3vw,14px);
  color:rgba(255,180,220,.4);
  letter-spacing:.15em;
  text-align:center;
}

/* flower selection cards â€” responsive grid */
.flower-cards{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:clamp(6px,2vw,14px);
  width:100%;
}
/* HP kecil: 3 kolom di baris pertama, 2 di bawah (dibuat di JS) */
@media(max-width:400px){
  .flower-cards{ grid-template-columns:repeat(3,1fr); }
}
@media(min-width:401px) and (max-width:520px){
  .flower-cards{ grid-template-columns:repeat(5,1fr); }
}

.fcard{
  display:flex;flex-direction:column;
  align-items:center;
  gap:clamp(4px,1vw,8px);
  padding:clamp(8px,2vw,16px) clamp(4px,1.2vw,10px);
  border:1px solid rgba(255,130,200,.15);
  border-radius:clamp(10px,2vw,16px);
  cursor:pointer;
  transition:all .22s ease;
  background:rgba(200,40,120,.04);
  -webkit-tap-highlight-color:transparent;
  touch-action:manipulation;
  position:relative;
  overflow:hidden;
  /* min tap size for mobile */
  min-height:44px;
}
.fcard::before{
  content:'';
  position:absolute;inset:0;
  border-radius:inherit;
  background:radial-gradient(circle at 50% 30%, rgba(255,100,200,.14) 0%, transparent 70%);
  opacity:0;transition:opacity .22s;
}
.fcard:hover::before,.fcard.sel::before{opacity:1;}
.fcard:hover,.fcard.sel{
  border-color:rgba(255,120,210,.7);
  background:rgba(180,30,110,.22);
  box-shadow:0 0 18px rgba(255,80,180,.35),inset 0 0 18px rgba(255,80,180,.06);
  transform:translateY(-2px);
}
.fcard.sel{
  border-color:rgba(255,160,230,.95);
  box-shadow:0 0 26px rgba(255,100,200,.6),inset 0 0 22px rgba(255,100,200,.1);
}

/* mini canvas preview â€” scales with viewport */
.fcard canvas{
  width:clamp(36px,9vw,62px)!important;
  height:clamp(36px,9vw,62px)!important;
  display:block;
  position:relative!important;
  top:auto!important;left:auto!important;
  flex-shrink:0;
}

.fcard-name{
  font-family:'Cinzel',serif;
  font-size:clamp(7px,2.2vw,11px);
  letter-spacing:.06em;
  color:rgba(255,200,230,.6);
  text-align:center;
  transition:color .22s;
  line-height:1.2;
}
.fcard:hover .fcard-name,.fcard.sel .fcard-name{color:#fff;}

/* enter button â€” big enough to tap on phone */
.enter-btn{
  font-family:'Cinzel',serif;
  font-size:clamp(11px,3.5vw,16px);
  font-weight:400;
  letter-spacing:.25em;
  color:rgba(255,200,230,.5);
  border:1px solid rgba(255,130,200,.25);
  border-radius:999px;
  padding:clamp(12px,3vw,16px) clamp(24px,8vw,52px);
  cursor:pointer;
  transition:all .25s;
  background:rgba(180,30,100,.06);
  -webkit-tap-highlight-color:transparent;
  touch-action:manipulation;
  opacity:.4;
  pointer-events:none;
  min-height:48px;
  display:flex;align-items:center;justify-content:center;
}
.enter-btn.ready{
  opacity:1;pointer-events:all;
  color:#fff;
  border-color:rgba(255,140,210,.8);
  background:rgba(180,30,110,.28);
  box-shadow:0 0 22px rgba(255,100,200,.4);
  animation:btnPulse 2s ease-in-out infinite;
}
@keyframes btnPulse{0%,100%{box-shadow:0 0 22px rgba(255,100,200,.4)}50%{box-shadow:0 0 36px rgba(255,100,200,.7)}}
.enter-btn.ready:active{
  background:rgba(200,40,130,.45);
  box-shadow:0 0 40px rgba(255,100,200,.75);
  transform:scale(.97);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GARDEN SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#garden{
  position:fixed;inset:0;
  opacity:0;visibility:hidden;
  transition:opacity .9s ease;
}
#garden.in{opacity:1;visibility:visible;}

canvas#gc{
  position:fixed;top:0;left:0;
  width:100%;height:100%;display:block;
}

#gui{
  position:fixed;inset:0;
  pointer-events:none;
  z-index:10;
  font-family:'Cinzel',serif;
}

/* top bar */
#gtop{
  position:absolute;top:0;left:0;right:0;
  padding:max(clamp(10px,3vw,18px),env(safe-area-inset-top,10px)) 16px 12px;
  background:linear-gradient(rgba(0,0,0,.72),transparent);
  display:flex;justify-content:center;align-items:center;
}
#gtitle{
  font-size:clamp(10px,3.2vw,17px);
  font-weight:300;
  letter-spacing:.28em;color:#fff;
  text-shadow:0 0 20px rgba(255,100,200,.8);
}
#gcount{
  position:absolute;right:clamp(12px,3.5vw,20px);
  font-size:clamp(11px,3vw,14px);
  color:rgba(255,160,220,.6);
  letter-spacing:.08em;
}

/* bottom bar */
#gbottom{
  position:absolute;bottom:0;left:0;right:0;
  padding:clamp(8px,2vw,14px) clamp(12px,4vw,22px);
  padding-bottom:max(clamp(14px,2vw,18px),env(safe-area-inset-bottom,14px));
  background:linear-gradient(transparent,rgba(0,0,0,.8));
  display:flex;align-items:center;justify-content:space-between;
  gap:6px;
  pointer-events:all;
}
#back-btn,#clear-btn{
  font-family:'Cormorant Garamond',serif;
  font-style:italic;
  font-size:clamp(13px,3.8vw,16px);
  color:rgba(255,180,220,.5);
  cursor:pointer;user-select:none;
  letter-spacing:.06em;
  text-decoration:underline;text-underline-offset:3px;
  transition:color .18s;
  -webkit-tap-highlight-color:transparent;
  touch-action:manipulation;
  padding:10px 6px;
  min-height:48px;
  display:flex;align-items:center;
  white-space:nowrap;
}
#back-btn:active,#clear-btn:active{color:rgba(255,200,240,.95);}
#mode-name{
  font-family:'Cormorant Garamond',serif;
  font-style:italic;
  font-size:clamp(12px,3.5vw,15px);
  color:rgba(255,180,220,.55);
  letter-spacing:.08em;
  text-align:center;
  flex:1;
  padding:0 4px;
}

/* garden hint */
#ghint{
  position:absolute;top:50%;left:50%;
  transform:translate(-50%,-50%);
  font-family:'Cormorant Garamond',serif;font-style:italic;
  font-size:clamp(15px,4.5vw,22px);
  color:rgba(255,200,230,.42);
  letter-spacing:.08em;text-align:center;
  pointer-events:none;width:80%;
  line-height:1.6;
  animation:pulse 2.8s ease-in-out infinite;
  transition:opacity .9s;
}
#ghint.gone{opacity:0;}
@keyframes pulse{0%,100%{opacity:.42}50%{opacity:.82}}

/* toast */
#gtoast{
  position:absolute;
  bottom:clamp(58px,15vw,95px);left:50%;
  transform:translateX(-50%);
  font-family:'Cormorant Garamond',serif;font-style:italic;
  font-size:clamp(12px,3.5vw,15px);
  color:rgba(255,225,240,.92);letter-spacing:.1em;
  opacity:0;transition:opacity .35s;
  pointer-events:none;white-space:nowrap;
}
#gtoast.show{opacity:1;}

/* ripple */
.rpl{
  position:fixed;border-radius:50%;
  pointer-events:none;z-index:25;
  width:6px;height:6px;
  border:2px solid rgba(255,120,200,.75);
  transform:translate(-50%,-50%) scale(0);
  animation:rplA .5s ease-out forwards;
}
@keyframes rplA{to{width:58px;height:58px;opacity:0;transform:translate(-50%,-50%) scale(1)}}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• WELCOME SCREEN â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="welcome">
  <canvas id="welcome-canvas"></canvas>
  <div class="welcome-inner">
    <div class="w-title">FLOWER GARDEN</div>
    <div class="w-sub">pilih bunga yang ingin kamu tanam</div>
    <div class="w-label">â€” pilih satu â€”</div>
    <div class="flower-cards" id="flower-cards">
      <!-- filled by JS -->
    </div>
    <div class="enter-btn" id="enter-btn">Mulai Berkebun</div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• GARDEN SCREEN â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="garden">
  <canvas id="gc"></canvas>
  <div id="gui">
    <div id="gtop">
      <div id="gtitle">âœ¦ FLOWER GARDEN âœ¦</div>
      <div id="gcount">âœ¿ 0</div>
    </div>
    <div id="ghint">tap & drag untuk menanam bunga</div>
    <div id="gtoast"></div>
    <div id="gbottom">
      <div id="back-btn">â† ganti bunga</div>
      <div id="mode-name"></div>
      <div id="clear-btn">âœ• hapus</div>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const rnd  = (a,b)=>a+Math.random()*(b-a);
const smst = (e0,e1,x)=>{const t=Math.max(0,Math.min(1,(x-e0)/(e1-e0)));return t*t*(3-2*t);}

function adjustL(hex,dl){
  const r=parseInt(hex.slice(1,3),16),
        g=parseInt(hex.slice(3,5),16),
        b=parseInt(hex.slice(5,7),16);
  const c=v=>Math.max(0,Math.min(255,Math.round(v+dl*2.55)));
  return `rgb(${c(r)},${c(g)},${c(b)})`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FLOWER MODES CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const MODES = [
  { id:0, name:'Lotus',  emoji:'ğŸŒ¸', desc:'merah muda berlapis',
    pal:['#ff99cc','#e0157a','#7a0045'], partCol:'#ff66bb' },
  { id:1, name:'Mawar',  emoji:'ğŸŒ¹', desc:'merah pekat',
    pal:['#ff7777','#dd1122','#880011'], partCol:'#ff4444' },
  { id:2, name:'Cosmos', emoji:'ğŸŒº', desc:'ungu violet',
    pal:['#cc88ff','#8822dd','#440099'], partCol:'#cc66ff' },
  { id:3, name:'Daisy',  emoji:'ğŸŒ¼', desc:'putih bersih',
    pal:['#ffffff','#eeeeff','#bbbbdd'], partCol:'#ddddff' },
  { id:4, name:'Burst',  emoji:'âœ¨', desc:'warna-warni',
    pal:['#ffaa44','#ff4400','#aa1100'], partCol:'#ffaa33' },
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CORE DRAW â€” shared between preview & garden
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawOnePetal(ctx, len, wid, cIn, cMid, cOut){
  ctx.beginPath();
  ctx.moveTo(0,0);
  ctx.bezierCurveTo( wid*.62,-len*.18,  wid*.58,-len*.78, 0,-len);
  ctx.bezierCurveTo(-wid*.58,-len*.78, -wid*.62,-len*.18, 0,0);
  const g=ctx.createLinearGradient(0,0,0,-len);
  g.addColorStop(0,  cIn);
  g.addColorStop(.4, cMid);
  g.addColorStop(1,  cOut);
  ctx.fillStyle=g; ctx.fill();
  // vein
  ctx.beginPath();
  ctx.moveTo(0,-len*.04); ctx.lineTo(0,-len*.86);
  ctx.strokeStyle='rgba(255,255,255,0.15)';
  ctx.lineWidth=Math.max(.4,wid*.09); ctx.lineCap='round'; ctx.stroke();
}

function drawShape(ctx, sz, g, modeId, pal){
  const [pIn,pMid,pOut]=pal;

  if(modeId===0){ // LOTUS â€” 3 layers
    [[8,1.0,.55,0],[8,.78,.50,+12],[6,.52,.44,+24]].forEach(([n,lr,wr,dl],li)=>{
      const l=sz*lr*g, w=sz*wr*g; if(l<.5)return;
      const ro=li%2===0?0:Math.PI/n;
      for(let i=0;i<n;i++){
        ctx.save();ctx.rotate(ro+i/n*Math.PI*2);
        drawOnePetal(ctx,l,w,adjustL(pIn,dl),adjustL(pMid,dl/2),adjustL(pOut,dl/3));
        ctx.restore();
      }
    });
  } else if(modeId===1){ // MAWAR â€” 3 cupped layers
    [[6,1.0,.68,0],[5,.75,.62,+12],[4,.50,.54,+22]].forEach(([n,lr,wr,dl],li)=>{
      const l=sz*lr*g, w=sz*wr*g; if(l<.5)return;
      const ro=li%2===0?0:Math.PI/n;
      for(let i=0;i<n;i++){
        ctx.save();ctx.rotate(ro+i/n*Math.PI*2);
        drawOnePetal(ctx,l,w,adjustL(pIn,dl),adjustL(pMid,dl/2),pOut);
        ctx.restore();
      }
    });
  } else if(modeId===2){ // COSMOS â€” 2 layers narrow
    [[10,1.0,.35,0],[8,.68,.32,+12]].forEach(([n,lr,wr,dl],li)=>{
      const l=sz*lr*g, w=sz*wr*g; if(l<.5)return;
      const ro=li===0?0:Math.PI/n;
      for(let i=0;i<n;i++){
        ctx.save();ctx.rotate(ro+i/n*Math.PI*2);
        drawOnePetal(ctx,l,w,adjustL(pIn,dl),adjustL(pMid,dl/2),pOut);
        ctx.restore();
      }
    });
  } else if(modeId===3){ // DAISY â€” many thin
    const n=16, l=sz*1.1*g, w=sz*.28*g;
    for(let i=0;i<n;i++){
      ctx.save();ctx.rotate(i/n*Math.PI*2);
      drawOnePetal(ctx,l,w,pIn,pMid,pOut);
      ctx.restore();
    }
  } else { // BURST â€” rainbow multi-petal
    const bPals=[
      ['#ffaa44','#ff4400','#aa1100'],
      ['#44ffbb','#00cc77','#006633'],
      ['#44aaff','#0055ee','#002299'],
      ['#ff44aa','#cc0077','#660033'],
    ];
    const n=12;
    for(let i=0;i<n;i++){
      const bp=bPals[i%bPals.length];
      const l=sz*rnd(.8,1.1)*g, w=sz*rnd(.28,.52)*g;
      ctx.save();ctx.rotate(i/n*Math.PI*2);
      drawOnePetal(ctx,l,w,bp[0],bp[1],bp[2]);
      ctx.restore();
    }
  }
}

function drawCentre(ctx, sz, g){
  const cr=sz*.28*g; if(cr<.8)return;
  // corona
  const co=ctx.createRadialGradient(0,0,cr*.3,0,0,cr*2.5);
  co.addColorStop(0,'rgba(255,200,0,.28)');
  co.addColorStop(.5,'rgba(255,130,0,.08)');
  co.addColorStop(1,'rgba(0,0,0,0)');
  ctx.beginPath();ctx.arc(0,0,cr*2.5,0,Math.PI*2);
  ctx.fillStyle=co;ctx.fill();
  // disc
  const dg=ctx.createRadialGradient(0,0,0,0,0,cr);
  dg.addColorStop(0,'#fffce0');
  dg.addColorStop(.2,'#ffee44');
  dg.addColorStop(.55,'#ffaa00');
  dg.addColorStop(.82,'#ff5500');
  dg.addColorStop(1,'#bb2200');
  ctx.beginPath();ctx.arc(0,0,cr,0,Math.PI*2);
  ctx.fillStyle=dg;ctx.fill();
  // stamens
  for(let i=0;i<8;i++){
    const a=i/8*Math.PI*2;
    ctx.beginPath();
    ctx.arc(Math.cos(a)*cr*.66,Math.sin(a)*cr*.66,cr*.1,0,Math.PI*2);
    ctx.fillStyle='rgba(40,10,0,.6)';ctx.fill();
  }
  // highlight
  const hi=ctx.createRadialGradient(-cr*.2,-cr*.2,0,0,0,cr*.55);
  hi.addColorStop(0,'rgba(255,255,200,.5)');
  hi.addColorStop(1,'rgba(255,255,200,0)');
  ctx.beginPath();ctx.arc(0,0,cr,0,Math.PI*2);
  ctx.fillStyle=hi;ctx.fill();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  WELCOME SCREEN â€” animated bg + card previews
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function setupWelcome(){
  const wCvs = document.getElementById('welcome-canvas');
  const wCtx = wCvs.getContext('2d');
  const WS   = performance.now();

  function resizeWCvs(){
    wCvs.width=innerWidth;wCvs.height=innerHeight;
  }
  resizeWCvs();
  window.addEventListener('resize',resizeWCvs);

  // gentle animated background flowers for welcome
  const bgFloaters=[];
  for(let i=0;i<10;i++){
    bgFloaters.push({
      x:Math.random(),y:Math.random()*1.2-.1,
      sz:rnd(30,65),spd:rnd(.012,.028),
      mode:Math.floor(Math.random()*5),
      rot:rnd(0,Math.PI*2),sway:rnd(0,Math.PI*2),
      pal:MODES[Math.floor(Math.random()*5)].pal,
      phase:rnd(0,Math.PI*2),
    });
  }

  function animateWelcome(){
    if(!document.getElementById('welcome').classList.contains('out')){
      requestAnimationFrame(animateWelcome);
    }
    const gt=(performance.now()-WS)/1000;
    wCtx.clearRect(0,0,innerWidth,innerHeight);
    bgFloaters.forEach(f=>{
      f.y-=f.spd*.016;
      if(f.y<-.15)f.y=1.1;
      const x=f.x*innerWidth+Math.sin(gt*.4+f.phase)*30;
      const y=f.y*innerHeight;
      wCtx.save();
      wCtx.translate(x,y);
      wCtx.rotate(f.rot+Math.sin(gt*.6+f.sway)*.06);
      wCtx.globalAlpha=.35;
      drawShape(wCtx,f.sz,1,f.mode,f.pal);
      drawCentre(wCtx,f.sz,1);
      wCtx.restore();
    });
  }
  animateWelcome();

  // build cards
  const cardsEl=document.getElementById('flower-cards');
  let selected=-1;

  MODES.forEach(m=>{
    const card=document.createElement('div');
    card.className='fcard';
    card.dataset.mode=m.id;

    // mini preview canvas â€” size based on actual card width
    const cardW = Math.min(innerWidth * 0.92, 540) / 5 - 12;
    const sz    = Math.max(32, Math.min(cardW * 0.7, 60));
    const pc=document.createElement('canvas');
    pc.width=sz*2;pc.height=sz*2;
    pc.style.width=sz+'px';pc.style.height=sz+'px';
    const pCtx=pc.getContext('2d');
    pCtx.scale(2,2);
    pCtx.translate(sz/2,sz/2);
    // draw static preview flower
    drawShape(pCtx,sz*.38,1,m.id,m.pal);
    drawCentre(pCtx,sz*.38,1);

    const name=document.createElement('div');
    name.className='fcard-name';
    name.textContent=m.name;

    card.appendChild(pc);
    card.appendChild(name);
    cardsEl.appendChild(card);

    function selectCard(){
      document.querySelectorAll('.fcard').forEach(c=>c.classList.remove('sel'));
      card.classList.add('sel');
      selected=m.id;
      document.getElementById('enter-btn').classList.add('ready');
    }
    card.addEventListener('click',e=>{e.stopPropagation();selectCard();});
    card.addEventListener('touchend',e=>{e.stopPropagation();e.preventDefault();selectCard();});
  });

  // enter button
  const enterBtn=document.getElementById('enter-btn');
  function doEnter(){
    if(selected<0)return;
    startGarden(selected);
    document.getElementById('welcome').classList.add('out');
    document.getElementById('garden').classList.add('in');
  }
  enterBtn.addEventListener('click',e=>{e.stopPropagation();doEnter();});
  enterBtn.addEventListener('touchend',e=>{e.stopPropagation();e.preventDefault();doEnter();});
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GARDEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let gCvs,gCtx,GW,GH,GDPR;
let flowers=[],parts=[],flCount=0,gMode=0,hintGone=false,GT0;

// â”€â”€ Particle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class Petal{
  constructor(x,y,col){
    this.x=x;this.y=y;this.col=col;
    this.vx=rnd(-1.8,1.8);this.vy=rnd(-2.8,-.7);
    this.grav=rnd(.03,.06);this.life=1;this.dec=rnd(.007,.017);
    this.sz=rnd(2.5,5.5)*Math.min(GW,GH)/900;
    this.a=rnd(0,Math.PI*2);this.da=rnd(-.07,.07);
  }
  step(){this.x+=this.vx;this.y+=this.vy;this.vy+=this.grav;this.a+=this.da;this.life-=this.dec;}
  draw(){
    if(this.life<=0)return;
    gCtx.save();
    gCtx.globalAlpha=this.life*.75;
    gCtx.translate(this.x,this.y);gCtx.rotate(this.a);
    gCtx.beginPath();
    gCtx.moveTo(0,0);
    gCtx.bezierCurveTo(this.sz*.6,-this.sz*.4,this.sz*.5,-this.sz*1.1,0,-this.sz*1.4);
    gCtx.bezierCurveTo(-this.sz*.5,-this.sz*1.1,-this.sz*.6,-this.sz*.4,0,0);
    gCtx.fillStyle=this.col;gCtx.fill();
    gCtx.restore();
  }
}

// â”€â”€ Bezier stem helper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function bezPt(f,t){
  const mt=1-t;
  return{
    x:mt*mt*mt*f.bx+3*mt*mt*t*f.c1x+3*mt*t*t*f.c2x+t*t*t*f.hx,
    y:mt*mt*mt*f.by+3*mt*mt*t*f.c1y+3*mt*t*t*f.c2y+t*t*t*f.hy
  };
}

function drawStem(f){
  if(f.grow<.02)return;
  const steps=55,nS=Math.floor(steps*f.grow);if(nS<1)return;
  const p0=bezPt(f,0),p1=bezPt(f,f.grow);
  const sg=gCtx.createLinearGradient(p0.x,p0.y,p1.x,p1.y);
  if(f.sy){
    sg.addColorStop(0,'#2a1e00');sg.addColorStop(.35,'#5a4800');
    sg.addColorStop(.7,'#3c5c0c');sg.addColorStop(1,'#1c5010');
  }else{
    sg.addColorStop(0,'#061a04');sg.addColorStop(.3,'#104008');
    sg.addColorStop(.7,'#167012');sg.addColorStop(1,'#1e8818');
  }
  gCtx.save();
  gCtx.shadowColor='rgba(20,100,15,.18)';gCtx.shadowBlur=4;
  gCtx.beginPath();
  gCtx.strokeStyle=sg;
  gCtx.lineWidth=Math.max(1.2,2.4*Math.min(GW,GH)/820);
  gCtx.lineCap='round';gCtx.lineJoin='round';
  const s0=bezPt(f,0);gCtx.moveTo(s0.x,s0.y);
  for(let i=1;i<=nS;i++){const p=bezPt(f,i/steps);gCtx.lineTo(p.x,p.y);}
  gCtx.stroke();gCtx.restore();

  if(f.grow>.48){
    const la=smst(.48,1,f.grow);
    f.lv.forEach(lf=>{
      if(lf.t>f.grow)return;
      const lp=bezPt(f,lf.t);
      const ll=Math.min(GW,GH)*.048*la;
      const ex=lp.x+Math.cos(lf.angle)*ll*lf.side;
      const ey=lp.y-ll*.65;
      const mx=lp.x+(ex-lp.x)*.4+lf.side*ll*.28;
      const my=lp.y+(ey-lp.y)*.4-ll*.2;
      gCtx.save();
      gCtx.shadowColor='rgba(20,110,10,.18)';gCtx.shadowBlur=3;
      gCtx.beginPath();gCtx.moveTo(lp.x,lp.y);
      gCtx.quadraticCurveTo(mx,my,ex,ey);
      gCtx.strokeStyle=f.sy?'#4a5c00':'#148018';
      gCtx.lineWidth=Math.max(1,1.5*Math.min(GW,GH)/820);
      gCtx.lineCap='round';gCtx.stroke();gCtx.restore();
    });
  }
}

function makeFlower(px,py){
  const bx=px+rnd(-20,20);
  return{
    hx:px,hy:py,mode:gMode,
    pal:MODES[gMode].pal,
    sz:rnd(30,58)*Math.min(GW,GH)/820,
    rot:rnd(0,Math.PI*2),
    sAmp:rnd(.012,.026),sSpd:rnd(.6,1.5),sOff:rnd(0,Math.PI*2),sway:0,
    bx,by:GH+6,
    c1x:bx+rnd(-110,110), c1y:GH-(GH-py)*rnd(.2,.38),
    c2x:px+rnd(-80,80),   c2y:py+(GH-py)*rnd(.22,.42),
    sy:Math.random()<.38,
    lv:[
      {t:rnd(.26,.42),side:Math.random()<.5?1:-1,angle:rnd(.5,.9)},
      {t:rnd(.55,.70),side:Math.random()<.5?1:-1,angle:rnd(.4,.8)},
    ],
    born:performance.now(),growDur:rnd(480,860),
    grow:0,spawned:false,
  };
}

function updateFlower(f,now,gt){
  f.grow=Math.min(1,(now-f.born)/f.growDur);
  f.sway=f.sAmp*Math.sin(gt*f.sSpd+f.sOff)*smst(.5,1,f.grow);
  if(f.grow>=1&&!f.spawned){
    f.spawned=true;
    const pc=MODES[f.mode].partCol;
    for(let i=0;i<14;i++)parts.push(new Petal(f.hx,f.hy,pc));
  }
}

function drawBloom(f){
  if(f.grow<.04)return;
  gCtx.save();
  gCtx.translate(f.hx,f.hy);
  gCtx.rotate(f.rot+f.sway);
  gCtx.shadowColor='rgba(0,0,0,.4)';
  gCtx.shadowBlur=f.sz*.5*f.grow;
  gCtx.shadowOffsetY=f.sz*.1*f.grow;
  drawShape(gCtx,f.sz,f.grow,f.mode,f.pal);
  gCtx.shadowBlur=0;gCtx.shadowOffsetY=0;
  drawCentre(gCtx,f.sz,f.grow);
  gCtx.restore();
}

let frameId=null;
function gFrame(){
  const now=performance.now(),gt=(now-GT0)/1e3;
  gCtx.fillStyle='#000';gCtx.fillRect(0,0,GW,GH);

  parts=parts.filter(p=>p.life>0);
  parts.forEach(p=>{p.step();p.draw();});
  flowers.forEach(f=>{updateFlower(f,now,gt);drawStem(f);});
  flowers.forEach(f=>drawBloom(f));
  frameId=requestAnimationFrame(gFrame);
}

function resizeGarden(){
  GDPR=Math.min(devicePixelRatio,2);
  GW=innerWidth;GH=innerHeight;
  gCvs.width=GW*GDPR;gCvs.height=GH*GDPR;
  gCvs.style.width=GW+'px';gCvs.style.height=GH+'px';
  gCtx.scale(GDPR,GDPR);
}

function startGarden(modeId){
  gMode=modeId;
  gCvs=document.getElementById('gc');
  gCtx=gCvs.getContext('2d');
  resizeGarden();
  GT0=performance.now();
  flowers=[];parts=[];flCount=0;hintGone=false;

  document.getElementById('mode-name').textContent=
    MODES[modeId].emoji+' '+MODES[modeId].name;

  window.addEventListener('resize',()=>{resizeGarden();clearGarden();});

  if(frameId)cancelAnimationFrame(frameId);
  gFrame();
  setupGardenEvents();
}

function addFlower(x,y){
  flowers.push(makeFlower(x,y));
  flCount++;
  document.getElementById('gcount').textContent=`âœ¿ ${flCount}`;
  if(!hintGone){hintGone=true;document.getElementById('ghint').classList.add('gone');}
  const r=document.createElement('div');
  r.className='rpl';r.style.cssText=`left:${x}px;top:${y}px`;
  document.body.appendChild(r);setTimeout(()=>r.remove(),560);
}

function clearGarden(){
  flowers=[];parts=[];flCount=0;
  document.getElementById('gcount').textContent='âœ¿ 0';
  gToast('taman dibersihkan ğŸŒ¿');
}

function goBack(){
  clearGarden();
  document.getElementById('welcome').classList.remove('out');
  document.getElementById('garden').classList.remove('in');
  // reset selection
  document.querySelectorAll('.fcard').forEach(c=>c.classList.remove('sel'));
  document.getElementById('enter-btn').classList.remove('ready');
}

let eventsReady=false;
function setupGardenEvents(){
  if(eventsReady)return;eventsReady=true;

  let isTouch=false;
  window.addEventListener('click',e=>{
    if(!isTouch&&document.getElementById('garden').classList.contains('in'))
      addFlower(e.pageX,e.pageY);
  });
  window.addEventListener('touchstart',e=>{
    if(!document.getElementById('garden').classList.contains('in'))return;
    isTouch=true;e.preventDefault();
    addFlower(e.changedTouches[0].pageX,e.changedTouches[0].pageY);
  },{passive:false});

  let drag=false,lx=0,ly=0;
  window.addEventListener('mousedown',e=>{drag=true;lx=e.pageX;ly=e.pageY;});
  window.addEventListener('mouseup',()=>drag=false);
  window.addEventListener('mousemove',e=>{
    if(!drag||!document.getElementById('garden').classList.contains('in'))return;
    if(Math.hypot(e.pageX-lx,e.pageY-ly)>60){addFlower(e.pageX,e.pageY);lx=e.pageX;ly=e.pageY;}
  });
  window.addEventListener('touchmove',e=>{
    if(!document.getElementById('garden').classList.contains('in'))return;
    e.preventDefault();
    const t=e.changedTouches[0];
    if(Math.hypot(t.pageX-lx,t.pageY-ly)>60){addFlower(t.pageX,t.pageY);lx=t.pageX;ly=t.pageY;}
  },{passive:false});

  const clearBtn=document.getElementById('clear-btn');
  clearBtn.addEventListener('click',e=>{e.stopPropagation();clearGarden();});
  clearBtn.addEventListener('touchend',e=>{e.stopPropagation();e.preventDefault();clearGarden();});

  const backBtn=document.getElementById('back-btn');
  backBtn.addEventListener('click',e=>{e.stopPropagation();goBack();});
  backBtn.addEventListener('touchend',e=>{e.stopPropagation();e.preventDefault();goBack();});
}

let tT2;
function gToast(m){
  const el=document.getElementById('gtoast');
  el.textContent=m;el.classList.add('show');
  clearTimeout(tT2);tT2=setTimeout(()=>el.classList.remove('show'),2e3);
}
</script>
</body>
</html>